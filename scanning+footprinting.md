# Scanning & Footprinting 

--- 

<br>

### Automated

AutoRecon:
- `sudo python3 autorecon.py <host>`
- `sudo python3 autorecon.py -t <hosts_file>`
- AutoRecon nmap command: `nmap -vv --reason -Pn -T4 -sV -sC --version-all -A --osscan-guess -p- -oN <ip>_full_tcp_nmap.txt <ip>`

<br>

### Port Scan 

nmap: 
- a) `nmap -T4 -p- <ip>`
- b) then, `nmap -T4 -A -p -n <port1>,<port2>,... <ip>`
- for UDP: `nmap -sU -T4 <ip>`

hping:
- TCP SYN scan: `hping3 -S --scan 80,443,... <ip_address>`
	- or `hping3 -S --scan [all|known] <ip_address>`
	- or `hping3 -S --scan 1-1000 <ip_address>`
	- `hping3 -S <ip_address> -p <port> -c <#_of_packets>`
- send 3 TCP SYN packets to default port 0: `hping3 -S <host> -c 3`
- send 3 TCP SYN packets to a port: `hping3 -S <host> -c 3 -p <port>`

netcat:
- TCP SYN port scan: `nc -nvv -w <timeout> -z <ip> <port_range>`
	- i.e. `nc -nvv -w 1 -z 10.11.1.220 3388-3390`
- UDP scan: `nc -nv -u -z -w <timeout> <ip> <port_range>`
	- i.e. `nc -nv -u -z -w 1 10.11.1.115 160-165`





<br>


### OS and Service Detection

With Nmap:
- OS fingerprinting `nmap -O --osscan-guess -v <ip_address>`
- service detection: `nmap -sV -n -p <ports> <ip_address>`
- both (aggressive scan): `nmap -A -n <target>`

With banner grabbing
- ncat / netcat / telnet: `[ncat|nc|telnet] <target> <port>`
- i.e. `nc <target> 22`

<br>

### Nmap NSE

- script stored in `/usr/share/nmap/scripts` 
- to get help information for script: `nmap --script-help [script|cateogory|expression]`
	- i.e. `nmap --script-help "smb*"`
	- i.e. `nmap --script-help dns-zone-transfer`
- to update current NSE: `nmap --script-updatedb`
- basic usage: `sudo nmap --script=<script_name> <target>`
	- i.e. `sudo nmap --script=smb-os-discovery -p 445 <target>`
    - i.e. `sudo nmap --script=whois-domain <target>` 
    - i.e. `sudo nmap --script=dns-zone-transfer -p 53 ns2.megacorpone.com`
- to run all scripts in a category: `sudo nmap --script <category> <target>`
	- i.e. `sudo nmap --script auth <target>`
- run all default scripts: `sudo nmap --script default <target>`

<br>

### Special Scans:

Zombie (idle) scan:
- nmap:
	- a) determine if IP ID sequence generation is incremental on zombie host: 
		- `nmap -O -v <ip_address>` 
		- or `sudo nmap --script idipseq <zombie_ip> -p <open_port>`
	- b) forge a SYN packet with the source address of the zombie and send it to the port of the target host (depending on how the target reacts, it may or may not cause the zombie IP ID to be incremented)
	- c) probe the zombie's IP ID again and, depending on the ID, you can infer if the target port is open or closed 
	- `nmap -Pn -sI <zombie-IP>:<open-zombie-port> <target> -p <ports> -v`
- hping:
	- a) find open ports on the zombie host:
		- `hping3 -S --scan known <ip_address>`
	- b) find if is a good zombie host by estimating the host (zombie) traffic:
		- `sudo hping3 -S -r <zombie_ip> -p <open_port>`
	- c ) craft a packet to send to target with zombie source IP:
		- `hping3 -a <zombie_ip> -S -p <target_port> <target_ip>`
	- d) continuously monitor the zombie ID to see if it increases or not:
		- `hping3 -S -r -p <port> <zombie_ip>`

nmap:
- FTP bounce scan: `nmap -sS -b -p <ports> <ip_address>`
- TCP null scan: `nmap -sN -p <ports> <ip_address>`
- TCP FIN scan: `nmap -sF -p <ports> <ip_address>`
- TCP XMAS scan: `nmap -sX -p <ports> <ip_address>`
- IP protocol scan: `nmap -sO <ip_address>`

hping:
- send a FIN flagged packet: `hping3 -F <host> -c 3`
- send a URG (urgent) flagged packet: `hping3 -U <host> -c 3`
- send an XMAS flagged packet: `hping3 -X <host> -c 3`
- send an YMAS flagged packet: `hping3 -Y <host> -c 3`
- send more than one flag: `hping3 -F -P -U <host> -c3`
- send to a subnet: `hping3 -1 <subnet>.x --rand-dest -I <iface>` 

<br>

### Firewall Evasion

fragmentation: 
- generic: `nmap -sS -f <target>`
	- to fragment to 16 bytes (rather than 8): `nmap -sS -f -f <target>` 
- for custom offset size (must be multiple of 8)`nmap -sS --mtu <size> <target>` 
- to add bytes to end and cause more fragments: `--data-length <bytes>`
	- i.e. `sudo nmap -f <target> -n -p 80 --disable-arp-ping -Pn --data-length 100`
- with hping: `sudo hping -S -f -p <port> <target> -c <count>`

decoys:
- generic: `nmap -sS -D [decoy1],[decoy2],[decoy...],ME,[decoy...] <target>`
	- i.e. `nmap -sS -D 10.10.24.43,10.22.12.99,ME,129.31.4.1,1.21.41.111 10.12.214.2`
- to use random IPs use `RND:<#_of_decoys>`:
	- i.e. `sudo nmap -p <port(s)> -D RND:10 <target>`
- with hping: `sudo hping3 --rand-source -S -p <port> <target> -c <count>`

timing:
- `nmap -sS -T[0-5] <target>`
- i.e. `nmap -sS -T2 10.12.41.55 -p 22,23,135,443,444,445 --max-retries 1`

source ports:
- generic: `nmap -sS --source-port <source_port> <target>` or `-g <source_port>`
	- i.e. `nmap -sS --source-port 53 <target>`
- with hping: `sudo hping3 -S -s 53 --scan known <target>`

appending random data:
- nmap: `sudo nmap -sS --data-length <data_length> -p <port> <target>`
- with hping: `sudo hping3 -S -p <port> --data <data_length> <target>`

MAC address spoofing:
- to use popular vendor MAC address: `sudo nmap --spoof-mac <vendor_name> <target> -p <port> -Pn --disable-arp-ping -n`
- to use random MAC address: `sudo nmap --spoof-mac 0 <target> -p <port> -Pn --disable-arp-ping -n`
- to use custom MAC address: `sudo nmap --spoof-mac <MAC_address> <target> -p <port> -Pn --disable-arp-ping -n`

randomising hosts:
- to scan hosts in a file randomly: `sudo nmap -iL hosts.txt -sS -p <ports> --randomize-hosts`
- with timing template: `sudo nmap -iL hosts.txt -sS -p 80,443,135,5555,21,22 --randomize-hosts -T2`
- with hping: `sudo hping3 -1 --rand-dest <subnet>.x -I <iface>`
- hping with a delay: `sudo hping3 -1 --rand-dest <subnet>.x -I <iface> -i u<microseconds>`


